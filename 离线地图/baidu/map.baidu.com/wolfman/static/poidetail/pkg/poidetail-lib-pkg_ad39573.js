define("poidetail:widget/libs/poiDetailCard/poiDetailCard.js",function(e,i,a){function t(e){e=e||{},e.padding=0,e.monopolize=!0,e.overflow="hidden",n.call(this,e),this.uid=e.uid,this.name=e.name,this.geo=e.geo,this.cardLevel=2,this.canNotFold=!0,this.returnTitle="返回“"+this.name+"”的详情",this.recordUrl="poi:"+this.uid,e.withMarker&&(this.pBindMarkerAndBubble(e.marker),this.withMarker=e.marker)}var n=e("common:widget/ui/card/Card.js"),o=e("common:widget/ui/card/cardMgr.js"),s=e("common:widget/ui/searchBox/searchBox.js"),r=e("common:widget/ui/util/util.js"),d=e("common:widget/ui/mapUtil/mapUtil.js"),h=e("common:widget/ui/constant/Constant.js"),l={common:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(0,-193),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},highlight:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},clicked:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET}};T.inherits(t,n,"PoiDetailCard"),T.extend(t.prototype,{render:function(){try{}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:76})}},onResize:function(e){function i(){var e=$(".poidetail-container").find(".generalHead-left-header"),i=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");n?(e.removeClass("animation-heightrelease").addClass("animation-heightadd2"),e.find("span.generalHead-titlename").css({"white-space":"normal"}),e.find(".business-vertify")&&(e.find(".business-vertify").addClass("business-vertify-newtop"),T.browser.safari&&T("#vertifyinfo").css("top","-23px"))):e.removeClass("animation-heightrelease").addClass("animation-heightadd"),i.removeClass("animation-heightrelease").addClass("animation-heightadd"),a.removeClass("animation-paddingrelease").addClass("animation-paddingadd"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-hide").addClass("animation-route-button-show"),$(".generalHead-left-header-aoitag").removeClass("animation-route-aoitag-hide").addClass("animation-aoitag-show"),$(".generalHead-left-header-visit").removeClass("animation-visittag-hide").addClass("animation-visittag-show")}function a(){var e=$(".poidetail-container").find(".generalHead-left-header"),i=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");n?e.removeClass("animation-heightadd2").addClass("animation-heightrelease"):e.removeClass("animation-heightadd").addClass("animation-heightrelease"),e.find("span.generalHead-titlename").css({"white-space":"nowrap"}),e.find(".business-vertify")&&(e.find(".business-vertify").removeClass("business-vertify-newtop"),T.browser.safari&&T("#vertifyinfo").css("top","-3px")),i.removeClass("animation-heightadd").addClass("animation-heightrelease"),a.removeClass("animation-paddingadd").addClass("animation-paddingrelease"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-show").addClass("animation-route-button-hide"),$(".generalHead-left-header-aoitag").removeClass("animation-aoitag-show").addClass("animation-aoitag-hide"),$(".generalHead-left-header-visit").removeClass("animation-visittag-show").addClass("animation-visittag-hide")}var t=this.$cardEl,n=this.titleNeedWrap;$(".generalHead-titlename ")&&$(".generalHead-titlename ").last()&&$(".generalHead-titlename ").last().height()>30&&(n=this.titleNeedWrap=!0);var o=$(".poidetail-container").find(".customerHead"),s=$(".poidetail-container").find(".customerOther");if(s.length){var r=s.height();s.css("height","auto"),s.css("overflow-y","auto"),s.css("max-height",e-o.height());var d,h=(t.height(),0),l=!0;s.off("scroll").on("scroll",function(){var e=$(this)[0].scrollTop;d=e>h?"down":"up",h=e,h>0&&"down"===d&&(l&&(a(),l=!1),r>=t.height()-45&&s.height(t.height()-45)),0===h&&"up"===d&&(l=!0,i(),setTimeout(function(){s.height(t.height()-o.height())},600))})}},initialize:function(){try{window.iFrameResize({log:!1},".hotelBookFrame"),T.browser.safari&&T("#vertifyinfo")&&T("#vertifyinfo").css("top","-24px")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:201})}},setInfoWindow:function(e){this.infoWindow=e},onFold:function(){o.removeCardFromGroup(this.cardId,"sole"),o.removeCardFromGroup(this.cardId,"result"),o.removeCardFromGroup(this.cardId,"poidetail"),this.withMarker&&!this.lockMarkerHighlight&&this.withMarker.unhighlight&&this.withMarker.unhighlight()},onUnfold:function(){o.addCardToGroup(this.cardId,"poidetail"),o.addCardToGroup(this.cardId,"sole"),o.addCardToGroup(this.cardId,"result"),s.setState("sole",{query:this.name,cardId:this.cardId}),this.childMarkers&&this.childMarkers.forEach(function(e){e.unhighlightMarker&&e.unhighlightMarker()}),this.withMarker&&this.withMarker.highlight&&this.withMarker.highlight()},pBindMarkerAndBubble:function(e){var i=r.getPointByStr(r.parseGeo(this.geo).points),a=this;if(i){var t=!1;e||(this.marker=new BMap.Marker(i,{icon:this.pCreateIcon(l.common),zIndexFixed:!0,startAnimation:"marker-raise marker-0"}),map.addOverlay(this.marker),d.setViewport([i],10),t=!0),this.name&&"string"==typeof this.name&&r.loadSearchSimpleInfo(function(e){var n=e.createCommonInfoWindow({name:a.name},{x:i.lng,y:i.lat,uid:a.uid,isFromMPC:!1});n&&(a.infoWindow=n,t&&a.pBindEvents())})}},pCreateIcon:function(e){return new BMap.Icon(e.image,e.size,{offset:e.offset,imageOffset:e.imageOffset,infoWindowOffset:e.infoWindowOffset,imageSize:e.imageSize,srcSet:e.srcSet})},pBindEvents:function(){var e=this;this.marker.addEventListener("click",function(){this.setIcon(e.pCreateIcon(l.clicked)),this.openSimpleInfoWindow(e.infoWindow),this.clicked=!0}),this.marker.addEventListener("mouseover",function(){this.clicked!==!0&&this.setIcon(e.pCreateIcon(l.highlight))}),this.marker.addEventListener("mouseout",function(){this.clicked!==!0&&this.setIcon(e.pCreateIcon(l.common))}),this.infoWindow.addEventListener("close",function(){e.marker.clicked=!1,e.marker.setIcon(e.pCreateIcon(l.common))})},unload:function(){window.temp&&window.temp.detailInfoPop&&window.temp.detailInfoPop.close(),this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null),this.marker&&(map.removeOverlay(this.marker),this.marker=null),this.childMarkers&&(this.childMarkers.forEach(function(e){map.removeOverlay(e)}),this.childMarkers=null),this.jssdkBaseData&&(this.jssdkBaseData=null),this.dispatchEvent("unload")}}),a.exports=t});
;define("poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",function(e,t,i){var a=".poidetail-container{position:relative;font-size:12px}.poidetail-container .mt10{margin-top:10px}.poidetail-container .top-border-override{border-top:1px solid #fff;position:relative;top:-1px}.poidetail-container .text-overflow{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.poidetail-container .title{height:40px;line-height:45px;position:relative}.poidetail-container .title .icon{width:21px;height:21px;display:inline-block;border-radius:50%;color:#FFF;background-color:#6cc8ef;position:absolute;left:0;top:11px;line-height:22px;text-align:center}.poidetail-container .title .caption{margin-left:25px;color:#333}.poidetail-container .title .more{position:absolute;display:block;right:0;top:15px;line-height:normal;color:#999;text-decoration:none}.poidetail-container .accept-default-image{border:0;background:url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png);background:-webkit-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-moz-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-o-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-ms-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background-size:cover}.poidetail-container .customerOther>div:last-child>div.bottom-split{border-bottom:0}";e.loadCss({content:a,name:"poiDetailMgr"});var o=e("common:widget/com/dynamicWidgetsPageMgr.js"),n=e("common:widget/ui/card/cardMgr.js"),r=e("poidetail:widget/libs/poiDetailCard/poiDetailCard.js"),d=e("common:widget/ui/searchBox/searchBox.js"),c=e("common:widget/ui/toast/toast.js"),s=e("poidetail:widget/unify/unifyMgr/unifyMgr.js"),l=e("common:widget/ui/JigsawVerification/JigsawVerification.js"),p=window.devicePixelRatio>1?2:1,g=document.createElement("a"),m={create:function(t,i){listener.trigger("poiDeatailMagr.create"),window.testbegin=new Date,this.opts=t||{},i=i||{};var a=1,o=this,n=T.extend(t,{ugc_type:"3",ugc_ver:"1",qt:"detailConInfo",device_ratio:p,compat:a,t:(new Date).getTime()});return d.loading(),new Promise(function(t,a){function r(n,r){var c={resolve:t,reject:a};if(n&&n.result){var p=n.result;if(window.AUTH=p.auth,99===p.type)return void l.open("",p.image,p.jigsawImage,function(){d.data.auth=window.AUTH,T.ajax("/",d)},function(){o.error("验证失败",a)})}n&&1===n.isUnify?s.init(n,i,c):o.processData(n,i,c),e.async(["common:widget/ui/urlManager/urlManager.js"],function(e){g.href=r.responseURL;var t="";n&&n.content&&(t=n.content.name);var a=g.search;i.noPushState||e.setFeature("poi",t,a,i.replaceState),e.setTitle(t)})}var d;d={method:"GET",data:n,timeout:3e3,dataType:"json",success:r,error:function(){o.error(null,a)}},d.data.auth=window.AUTH,T.ajax("/",d)})},error:function(e,t){e=e||"当前信息加载失败，请稍后再试",c.show(e,"warning"),d.endLoading(),t(e)},processData:function(e,t,i){if(!e||!e.content)return void this.error("",i.reject);this.opts&&this.opts.isBizPoi&&(e.isBizPoi=!0);var a=e.content.indoor_pano||"";if(e.content.indoor_pano_id="",""!==a){var o=/&sid=([0-9a-z]+?)&/i.exec(a);o&&(e.content.indoor_pano_id=o[1])}e._extra_={enableComment:!0},e.content.ext=e.content.ext||{},e.content.ext.detail_info=e.content.ext.detail_info||{},e.content.ext.detail_info.groupon=e.content.ext.detail_info.groupon||[],e.content.ext.rich_info=e.content.ext.rich_info||{},e.content.ext.other_info=e.content.ext.other_info||{},e.content.ext.src_name=e.content.ext.src_name||"",e.interSource=e.interSource||"",e.hasDetailPage="ninf"===e.interSource?!0:!1;for(var n=e.content.ext.detail_info.std_tag||e.content.ext.detail_info.tag||e.content.ext.src_name||"",r=["医疗","公交","车站","地铁站","dt_stop","房地产","政府机构","洗浴按摩"],d=r.length-1;d>=0;d--){var c=new RegExp(r[d],"i");if(c.test(n)){e._extra_.enableComment=!1;break}}e.content.poiType&&1===e.content.poiType&&(e._extra_.enableComment=!1),this.distribute(e,t,i)},distribute:function(t,i,a){var o={};t.content&&t.content.ext&&(o=t.content.ext);var n,r=o.src_name||this.opts.industry||"";switch(r){case"scope":n=e("poidetail:widget/industry/scopeIndustryMgr.js");break;case"hotel":n=e("poidetail:widget/industry/hotelIndustryMgr.js");break;case"cater":n=e("poidetail:widget/industry/caterIndustryMgr.js");break;default:n=e(o.movie_forsearch&&"movie"===o.movie_forsearch.business_scope_type?"poidetail:widget/industry/movieIndustryMgr.js":"poidetail:widget/industry/lifeIndustryMgr.js")}this.buildPoiDetailPage(n,t,i,a)},buildPoiDetailPage:function(e,t,i,a){e.init(t,function(e){var c=t&&t.content&&t.content.uid,s=t&&t.content&&t.content.name,l=t&&t.content&&t.content.geo;i=i||{},i=T.extend({record:!0},i),i=T.extend(i,{uid:c,name:s,geo:l});var p=new r(i);a.resolve({poiDetailCard:p,data:t}),e.pageData=e.pageData||t,e.containerClass="poidetail-container";var g=[];g.push({js:"poidetail:widget/ui/generalHead/generalHead.js",data:t.content,wrapClass:"customerHead"}),g.push({children:e.widgets,wrapClass:"customerOther"}),e.widgets=g;var m=new o(e);m.addEventListener("renderComplete",function(){try{p.render=function(){try{if(addStat("poidetail.card.render","show"),e&&e.pageData){var t=e.pageData;t.industry&&addStat("poidetail."+t.industry+".render","show")}return m.getPageDom()}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:321})}},d.endLoading(),n.add(p,{isReturn:i.isReturn}).then(function(){d.setState("sole",{query:s,cardId:p.cardId},{keepResult:i.record})}),n.addCardToGroup(p.cardId,"poidetail")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:329})}}),m.addEventListener("endLoading",function(){d.endLoading()}),m.buildPage(p)})}};i.exports=m});
;define("poidetail:widget/libs/poiDetailUtil/poiDetailUtil.js",function(e,r,t){var n={isIE:function(e){var r=document.createElement("b");return r.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===r.getElementsByTagName("i").length},len:function(e){for(var r=0,t=e.length,n=-1,i=0;t>i;i++){var n=e.charCodeAt(i);r+=n>=0&&128>=n?1:2}return r},sub:function(e,r){var t=/[^\x00-\xff]/g;if(e.replace(t,"mm").length<=r)return e;for(var n=Math.floor(r/2),i=n;i<e.length;i++)if(e.substr(0,i).replace(t,"mm").length>=r)return e.substr(0,i)+"...";return e},isEmptyobj:function(e){if(e){for(var r in e)return!1;return!0}return!0}};t.exports=n});